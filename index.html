<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erfinder</title>
    
    <!-- CSS-Dateien -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/tabs.css">
    <link rel="stylesheet" href="src/styles/webview.css">
    <link rel="stylesheet" href="src/styles/downloads.css">
    <link rel="stylesheet" href="src/styles/ui.css">
</head>
<body>
    <!-- Navigation Bar -->
    <div class="top-bar">
        <div class="nav-buttons">
            <button class="nav-btn" id="backBtn" title="Zur√ºck">‚Üê</button>
            <button class="nav-btn" id="forwardBtn" title="Vorw√§rts">‚Üí</button>
            <button class="nav-btn" id="reloadBtn" title="Neu laden">‚Üª</button>
        </div>
        
        <div class="url-container">
            <input type="text" class="url-input" id="urlInput" placeholder="Gib eine kinderfreundliche Webseite ein...">
            <button class="go-btn" id="goBtn" title="Los!">‚Üí</button>
        </div>
        
        <button class="home-btn" id="homeBtn">üè† Startseite</button>
        <button id="parent-btn" title="Elternbereich" class="parent-btn">
            <span style="font-size:1.3em; vertical-align:middle;">üîí</span> Elternbereich
        </button>
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar" id="tabBar">
        <div class="tab active" id="tab-0" data-tab-id="0">
            <img class="tab-favicon" id="tab-favicon-0" src="assets/globe.svg" width="16" height="16" style="vertical-align:middle;margin-right:4px;">
            <span class="tab-title">FragFinn</span>
            <button class="tab-close" onclick="closeTab(0)">√ó</button>
        </div>
        <button class="new-tab-btn" id="newTabBtn" title="Neuer Tab">+</button>
    </div>

    <!-- Content Area -->
    <!-- PIN Modal -->
    <div id="pinModal" class="pin-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0006;z-index:9999;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:32px 24px;border-radius:16px;box-shadow:0 2px 16px #0002;max-width:320px;margin:auto;text-align:center;">
            <h2 style="margin-bottom:16px;">üîí Eltern-PIN</h2>
            <p id="pinModalText" style="margin-bottom:16px;">Bitte gib die 4-stellige Eltern-PIN ein:</p>
            <input id="pinInput" type="password" maxlength="4" pattern="[0-9]*" inputmode="numeric" style="font-size:2em;text-align:center;width:100px;letter-spacing:12px;padding:8px;margin-bottom:16px;" autofocus>
            <div>
                <button id="pinCancelBtn" style="background:#eee;color:#444;font-weight:bold;padding:8px 24px;border:none;border-radius:8px;">Abbrechen</button>
            </div>
            <div id="pinError" style="color:#f44336;margin-top:12px;display:none;">Falsche PIN!</div>
        </div>
    </div>
    <div class="content-area">
        <!-- Initial Tab Container -->
        <div class="webview-container" id="webview-container-0" data-tab-id="0">
            <webview class="webview" id="webview-0" src="https://www.fragfinn.de" partition="persist:main" allowpopups></webview>
            
            <div class="loading" id="loading-0">
                <div class="spinner"></div>
            </div>
            
            <div class="blocked-message" id="blockedMessage-0">
                <div class="blocked-content">
                    <h2>üö´ Webseite blockiert</h2>
                    <p class="blocked-message-text">Diese Webseite ist f√ºr Kinder nicht geeignet. Frage deine Eltern wenn du sie freischalten m√∂chtest.</p>
                </div>
            </div>
        </div>

        <!-- Download Manager -->
        <div class="download-manager" id="downloadManager">
            <div class="download-header">
                <span>üì• Downloads</span>
                <button onclick="toggleDownloadManager()">√ó</button>
            </div>
            <div id="downloadList"></div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="security-indicator">
            <div class="security-icon" id="securityIcon"></div>
            <span id="securityText">Sicher</span>
        </div>
        <div id="statusText">Bereit</div>
    </div>

    <!-- JavaScript Module -->
    <script src="src/js/pin.js"></script>
    <script src="src/js/whitelist.js"></script>
    <script src="src/js/tab-manager.js"></script>
    <script src="src/js/ipc-handler.js"></script>
    <script src="src/js/webview-manager.js"></script>
    <script src="src/js/navigation-manager.js"></script>
    <script src="src/js/ui-manager.js"></script>
    <script src="src/js/main-app.js"></script>
    <script>
    document.getElementById('parent-btn').onclick = async function() {
        // Erstkonfiguration pr√ºfen
        const firstRunCompleted = localStorage.getItem('firstRunCompleted');
        const parentalPin = localStorage.getItem('parentalPin');
        
        if (!firstRunCompleted || !parentalPin) {
            // First-run wizard √ºber IPC √∂ffnen f√ºr bessere Integration
            try {
                const result = await window.ipcHandler.invoke('show-first-run-wizard');
                if (!result.success) {
                    console.error('Fehler beim √ñffnen des Einrichtungsassistenten:', result.error);
                }
            } catch (error) {
                console.error('IPC-Fehler beim √ñffnen des Einrichtungsassistenten:', error);
                // Fallback zu window.open
                window.open('first-run-wizard.html', '_blank', 'width=700,height=600,menubar=no,toolbar=no,location=no,status=no,resizable=no');
            }
        } else {
            // Elternbereich √ºber IPC √∂ffnen f√ºr bessere Integration
            try {
                const result = await window.ipcHandler.invoke('show-parent-area');
                if (!result.success) {
                    console.error('Fehler beim √ñffnen des Elternbereichs:', result.error);
                }
            } catch (error) {
                console.error('IPC-Fehler beim √ñffnen des Elternbereichs:', error);
                // Fallback zu window.open
                window.open('parents.html', '_blank', 'width=800,height=700,menubar=no,toolbar=no,location=no,status=no');
            }
        }
    };
    </script>
</body>
</html>
